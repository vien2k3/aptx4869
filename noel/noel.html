<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- audio stays in head so we can control it before/when opening -->
    <audio id="audio" src="./noel.mp3" preload="auto" loop></audio>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ephesis&family=Roboto:wght@500&display=swap');

        /* page center */
        html,body{ height:100%; }
        body {
            background-color: #151522;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 28px;
            box-sizing: border-box;
            font-family: Roboto, sans-serif;
        }

        /* card (thi·ªáp) */
        .card {
            width: min(1100px, 94%);
            max-width: 1100px;
            height: min(760px, 92vh);
            max-height: 760px;
            background: linear-gradient(135deg, #FFF8F0 0%, #FFF0FB 100%);
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 28px 60px rgba(9,10,20,0.6), inset 0 1px 0 rgba(255,255,255,0.6);
            border: 1px solid rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
            perspective: 1200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card::before{
            content: "";
            position: absolute;
            right: 0;
            top: 0;
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, rgba(0,0,0,0.06), rgba(255,255,255,0.6));
            clip-path: polygon(100% 0, 100% 40%, 60% 0);
            transform-origin: top right;
            opacity: 0.9;
        }

        .card::after{
            content: "";
            position: absolute;
            left: 14px;
            top: 14px;
            bottom: 14px;
            width: 6px;
            background: linear-gradient(180deg,#ffdde1 0%, #ffd6a5 100%);
            border-radius: 6px;
            box-shadow: 0 0 18px rgba(255,200,160,0.12);
        }

        /* cover that will "open" */
        /* stronger book-like cover + hinge animation */
        .card {
            transform-style: preserve-3d;
            perspective: 2000px;
        }

        .card-cover{
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            transform-origin: left center;
            transform: rotateY(0deg) translateZ(0);
            /* slower + smoother transition */
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1), box-shadow 900ms;
            will-change: transform, opacity;
            z-index: 70;
            display: block;
            pointer-events: auto;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        /* visual front face of the cover */
        .card-cover .cover-front{
            position: absolute;
            inset: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, #f7efe8 0%, #f3e7f0 100%);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), 0 20px 50px rgba(5,6,10,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: left center;
            backface-visibility: hidden;
            z-index: 75; /* ensure cover front (button) sits above page stack */
        }

        /* realistic back of cover */
        .card-cover::after{
            content: "";
            position:absolute;
            inset:0;
            border-radius:20px;
            background: linear-gradient(180deg,#e8dfd8 0%, #dcd0dc 100%);
            transform: rotateY(180deg);
            backface-visibility: hidden;
            z-index:-1;
        }

        /* hinge shadow to accentuate opening */
        .card-cover::before{
            content: "";
            position:absolute;
            left: -5%;
            top: 0;
            bottom: 0;
            width: 8%;
            border-radius: 4px;
            background: linear-gradient(90deg, rgba(0,0,0,0.28), rgba(0,0,0,0.06));
            transform-origin: left center;
            opacity: 0.0;
            transition: opacity 500ms ease;
            pointer-events: none;
        }

        /* thin stack of pages between cover and content */
        .pages{
            position:absolute;
            left:6%;
            top:6%;
            width:88%;
            height:88%;
            border-radius:12px;
            background:
                linear-gradient(90deg, rgba(255,255,255,0.99) 0%, rgba(250,250,250,0.98) 100%);
            box-shadow: 0 8px 22px rgba(10,10,20,0.18), inset 0 0 0 1px rgba(0,0,0,0.02);
            transform-origin: left center;
            transform: rotateY(0deg);
            z-index: 50; /* lower than cover-front so button remains visible */
            pointer-events: none;
            /* slower + smoother transition */
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1), box-shadow 900ms;
            will-change: transform, opacity;
        }

        .pages::before{
            content: "";
            position:absolute;
            left: -10px;
            top: 6%;
            bottom: 6%;
            width: 10px;
            border-radius: 6px;
            background: linear-gradient(180deg, rgba(220,220,220,0.95), rgba(200,200,200,0.6));
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }

        /* when open: cover swings like a book, pages lean, content shifts/tilts */
        .card.open .card-cover{
            transform: rotateY(-180deg) translateX(-6%) translateZ(-1px);
            box-shadow: 0 40px 80px rgba(0,0,0,0.45);
            /* keep cover on top of pages while opening */
            z-index: 80;
        }
        .card.open .card-cover::before{ opacity: 1; transform: translateX(-6%); }

        .card.open .pages{
            transform: rotateY(-12deg) translateX(8%);
            box-shadow: 0 12px 36px rgba(0,0,0,0.26);
        }

        /* Book-fold effect: staged opening for a nicer "g·∫≠p s√°ch" look */
        /* initial staged class while animating */
        .card.opening .card-cover{ transition-duration: 2400ms; }
        .card.opening .pages{ transition-duration: 2400ms; }

        /* folded appearance when fully open */
        .card.open .pages{
            transform: rotateY(-22deg) translateX(6%) skewY(-2deg);
            box-shadow: 0 18px 48px rgba(0,0,0,0.32);
        }

        /* subtle tilt and depth for inner content to read as a page spread */
        .card.open .card-inner{
            transform: translateX(14%) rotateY(10deg) translateZ(8px) rotateZ(-1deg);
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1);
            will-change: transform, opacity;
        }

        .card.open .card-inner > * {
            transform: translateZ(10px);
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1);
        }

        /* folded edge visual using pages::after */
        .pages::after{
            content: "";
            position: absolute;
            right: -6%;
            top: 6%;
            bottom: 6%;
            width: 36%;
            border-radius: 0 8px 8px 0;
            background: linear-gradient(90deg, rgba(0,0,0,0.06), rgba(255,255,255,0.04));
            transform-origin: left center;
            transform: translateX(8%) skewY(0deg) rotateY(0deg);
            opacity: 0;
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1), opacity 1200ms ease;
            pointer-events: none;
            z-index: 55;
        }

        .card.open .pages::after{
            opacity: 1;
            transform: translateX(-6%) skewY(-6deg) rotateY(-12deg);
        }

        .card.open .card-inner{
            transform: translateX(12%) rotateY(8deg) translateZ(0);
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1);
        }

        /* small 3D lift for content when opened */
        .card.open .card-inner > * {
            transform: translateZ(6px);
            transition: transform 2400ms cubic-bezier(.2,.8,.2,1);
        }

        /* responsive: tr√™n m√†n nh·ªè chuy·ªÉn th√†nh c·ªôt, v·∫´n kh√¥ng cu·ªôn */
        @media (max-width: 820px){
            .card-inner {
                flex-direction: column;
                padding: 18px;
                gap: 18px;
            }
            .card-inner .mainSVG { width: 92%; max-height: 46vh; }
            .card-inner .side { width: 92%; }
        }

        /* centered open button on the cover */
        .open-btn{
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg,#ff6b6b 0%, #ffb86b 100%);
            color: #fff;
            border: none;
            padding: 12px 22px;
            border-radius: 999px;
            cursor: pointer;
            font-family: Roboto, sans-serif;
            font-weight: 600;
            font-size: 18px;
            letter-spacing: 0.2px;
            box-shadow: 0 8px 30px rgba(255,107,107,0.18), 0 2px 6px rgba(0,0,0,0.28);
            transform: translateZ(40px);
            transition: transform .18s cubic-bezier(.2,.9,.3,1), box-shadow .18s ease, opacity .18s;
            -webkit-tap-highlight-color: transparent;
        }
        .open-btn::before{
            content: "üéÅ";
            display: inline-block;
            font-size: 20px;
            transform: translateY(-1px);
        }
        .open-btn:hover, .open-btn:focus{
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 18px 44px rgba(255,107,107,0.22);
            outline: none;
        }
        .open-btn:active{
            transform: translateY(-2px) scale(.995);
        }
        .open-btn.pulse{
            animation: cardPulse 1.8s infinite;
        }
        @keyframes cardPulse{
            0% { box-shadow: 0 8px 30px rgba(255,107,107,0.18); transform: translateZ(40px) }
            50% { box-shadow: 0 20px 60px rgba(255,107,107,0.26); transform: translateY(-6px) scale(1.02) }
            100% { box-shadow: 0 8px 30px rgba(255,107,107,0.18); transform: translateZ(40px) }
        }
        /* tr·∫°ng th√°i khi ƒë√£ m·ªü */
        .open-btn[aria-pressed="true"]{
            background: linear-gradient(135deg,#4caf50 0%, #2e7d32 100%);
            box-shadow: 0 10px 30px rgba(46,125,50,0.18);
        }
        .open-btn:focus-visible{
            box-shadow: 0 0 0 4px rgba(255,182,74,0.16);
        }

        /* small responsive tweaks */
        @media (max-width:700px){
            .open-btn{ font-size:16px; padding:10px 16px; gap:8px; }
        }

        /* ƒë·∫£m b·∫£o v√πng n·ªôi dung hi·ªÉn th·ªã v√† b·ªë c·ª•c 2 c·ªôt */
        /* layout: 2-column balanced composition (c√¢y tr√°i, ch·ªØ + √¥ng gi√† phil b√™n ph·∫£i) */
        .card-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 28px;
            position: relative;
            padding: 24px;
            box-sizing: border-box;
            z-index: 10;
            overflow: hidden; /* kh√¥ng cu·ªôn l√™n xu·ªëng */
        }

        /* SVG (c√¢y) chi·∫øm kho·∫£ng 60% chi·ªÅu ngang card */
        .card-inner .mainSVG {
            width: 60%;
            height: auto;
            max-height: calc(100% - 48px);
            display: block;
        }

        /* v√πng ph·∫£i ch·ª©a ch·ªØ v√† √¥ng gi√† noel */
        .card-inner .side {
            width: 36%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 18px;
            box-sizing: border-box;
            padding: 8px 12px;
            text-align: center;
        }

        .card-inner .text {
            margin: 0;
            font-size: clamp(20px, 3.2vw, 36px);
            color: #2b1a12;
            font-family: 'Ephesis', serif;
            letter-spacing: 0.6px;
        }

        /* subtitle under the main greeting: same font family, smaller size, centered */
        .card-inner .subtext {
            margin-top: 8px;
            /* slightly larger and bolder for better readability */
            font-size: clamp(14px, 2vw, 20px);
            color: #2b1a12;
            font-family: 'Ephesis', serif;
            letter-spacing: 0.45px;
            line-height: 1.25;
            font-weight: 700;
            text-shadow: 0 0.6px 0 rgba(0,0,0,0.06);
            /* keep more breathing room on the right so text displays fully */
            padding: 0 32px 0 8px;
            max-width: calc(100% - 40px);
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        .card-inner .santa-claus {
            width: min(320px, 100%);
            height: auto;
        }

        /* DEBUG: t·∫°m ·∫©n b√¨a khi ƒë√£ m·ªü ƒë·ªÉ ch·∫Øc ch·∫Øn n·ªôi dung hi·ªÉn th·ªã (b·ªè/ghi ch√∫ khi xong) */
        /* .card.open .card-cover { display: none !important; } */

        /* Snow canvas sits above the card and draws falling snowflakes */
        #snowCanvas{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 95; /* above most card elements but below UI overlays if any */
        }

        /* Mobile tweaks: reduce heavy shadows and ensure layout fits */
        @media (max-width: 600px){
            .card { padding: 16px; }
            .open-btn{ padding: 10px 14px; font-size: 15px; }
            .card-inner .subtext{ padding-right: 40px; }
        }
    </style>
</head>

<body>
    <div class="card" role="group" aria-label="Greeting card">
        <!-- canvas for snowfall effect -->
        <canvas id="snowCanvas" aria-hidden="true"></canvas>
        <!-- cover n·∫±m tr√™n n·ªôi dung; c√≥ n√∫t gi·ªØa cover -->
        <div class="card-cover" aria-hidden="true">
            <div class="cover-front">
                <button id="openBtn" class="open-btn pulse" aria-pressed="false">·∫§n v√†o ƒë√¢y ƒë·ªÉ m·ªü</button>
            </div>
            <div class="pages" aria-hidden="true" aria-label="pages visual"></div>
        </div>

        <!-- n·ªôi dung thi·ªáp s·∫Ω ƒë∆∞·ª£c inject t·ª´ template khi m·ªü -->
        <div class="card-inner" id="cardInner" aria-live="polite"></div>
    </div>

    <!-- template ch·ª©a to√†n b·ªô "ƒëo·∫°n code g·ªëc" (SVG + scripts + dotlottie) - kh√¥ng ch·∫°y khi c√≤n trong template -->
    <template id="cardContent">
        <!-- begin original content -->
        <!-- SVG (kept as-is) -->
        <svg class="mainSVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 800 600">
            <defs>
                <circle id="circ" class="particle" cx="0" cy="0" r="1" />
                <polygon id="star" class="particle"
                    points="4.55,0 5.95,2.85 9.1,3.3 6.82,5.52 7.36,8.65 4.55,7.17 1.74,8.65 2.27,5.52 0,3.3 3.14,2.85 " />
                <polygon id="cross" class="particle"
                    points="4,3.5 2.5,2 4,0.5 3.5,0 2,1.5 0.5,0 0,0.5 1.5,2 0,3.5 0.5,4 2,2.5 3.5,4 " />
                <path id="heart" class="particle" d="M2.9,0C2.53,0,2.2,0.18,2,0.47C1.8,0.18,1.47,0,1.1,0C0.49,0,0,0.49,0,1.1
                C0,2.6,1.56,4,2,4s2-1.4,2-2.9C4,0.49,3.51,0,2.9,0z" />


                <radialGradient id="grad" cx="3" cy="3" r="6" gradientUnits="userSpaceOnUse">
                    <stop offset="0" style="stop-color:red" />
                    <stop offset="0.4" style="stop-color:#334673" />
                    <stop offset="0.6" style="stop-color:#EDDDC4" />
                    <stop offset="0.9" style="stop-color:#FEE8C7" />
                    <stop offset="1" style="stop-color:red" />
                </radialGradient>
                <radialGradient id="dotGrad" cx="0" cy="0" r="50" gradientUnits="userSpaceOnUse">
                    <stop offset="0" style="stop-color:#FFFFFF;stop-opacity:1" />
                    <stop offset="0.1" style="stop-color:#0867C7;stop-opacity:0.6" />
                    <stop offset="1" style="stop-color:#081029;stop-opacity:0" />
                </radialGradient>

                <mask id="treePathMask">
                    <path class="treePathMask" fill="none" stroke-width="18" stroke="#FFF" d="M252.9,447.9c0,0-30.8-21.6,33.9-44.7c64.7-23.1,46.2-37,33.9-41.6
                c-12.3-4.6-59.3-11.6-42.4-28.5s114-52.4,81.7-66.2c-32.4-13.9-58.5-10.8-35.4-29.3s66.2-101.7,70.9-115.6
                c4.4-13.2,16.9-18.5,24.7,0c7.7,18.5,44.7,100.1,67.8,115.6c23.1,15.4-10.8,21.6-26.2,24.7c-15.4,3.1-20,33.9,33.9,49.3
                c53.9,15.4,47.8,40.1,27.7,44.7c-20,4.6-63.2,4.6-27.7,32.4s98.6,21.6,61.6,60.1" />
                </mask>
                <mask id="treeBottomMask">
                    <path class="treeBottomMask" stroke="#FFF" stroke-width="8"
                        d="M207.5,484.1c0,0,58.5-43.1,211.1-3.1s191-16.9,191-16.9" />
                </mask>
                <mask id="treePotMask">
                    <path class="treePotMask" stroke="#FFF" stroke-width="8"
                        d="M374.3,502.5c0,0-4.6,20,7.7,29.3c12.3,9.2,40.1,7.7,50.8,0s10.8-23.1,10.8-29.3" />
                </mask>

                <filter id="glow" x="-150%" y="-150%" width="280%" height="280%">
                    <feOffset result="offOut" in="SourceGraphic" dx="0" dy="0" />
                    <feGaussianBlur in="offOut" stdDeviation="16" result="blur" />

                    <feComponentTransfer>
                        <feFuncR type="discrete" tableValues="0.8" />
                        <feFuncG type="discrete" tableValues="0.3" />
                        <feFuncB type="discrete" tableValues="0.2" />
                        <!--<feFuncA type="linear" slope="1" intercept="0" />-->
                    </feComponentTransfer>

                    <feComposite in="SourceGraphic" operator="over" />

                </filter>

            </defs>
            <g class="whole">

                <g class="pContainer"></g>

                <g class="tree" mask="url(#treePathMask)">
                    <path
                        d="M252.95,447.85a20.43,20.43,0,0,1-5.64-6.24,14,14,0,0,1-1.91-8.22,16.93,16.93,0,0,1,3.06-8,33.16,33.16,0,0,1,5.79-6.28A74.78,74.78,0,0,1,268.54,410a163.48,163.48,0,0,1,15.52-6.84c10.54-3.93,21-8.07,30.72-13.46a80.83,80.83,0,0,0,7-4.37,37.51,37.51,0,0,0,6.13-5.24c1.75-1.92,3.14-4.18,3.25-6.35s-1.12-4.18-3-5.81a25,25,0,0,0-6.72-3.91,61.25,61.25,0,0,0-7.8-2.42c-5.41-1.4-10.91-2.72-16.38-4.32a84.17,84.17,0,0,1-16.2-6.19,28.26,28.26,0,0,1-3.86-2.5,15.06,15.06,0,0,1-3.44-3.63,9,9,0,0,1-1.51-5.47,10.22,10.22,0,0,1,.61-2.78,12.88,12.88,0,0,1,1.2-2.34,26.73,26.73,0,0,1,6.58-6.56c2.35-1.76,4.76-3.33,7.19-4.84,4.87-3,9.82-5.75,14.77-8.46,9.91-5.4,19.88-10.59,29.63-16.08,4.87-2.75,9.68-5.56,14.33-8.56A81.88,81.88,0,0,0,359.45,280a23,23,0,0,0,2.41-2.79,8.36,8.36,0,0,0,1.35-2.65,2.13,2.13,0,0,0-.17-1.7,5.53,5.53,0,0,0-1.88-1.77,13.15,13.15,0,0,0-1.49-.83c-.52-.26-1.1-.49-1.76-.77-1.27-.53-2.55-1-3.83-1.53q-3.86-1.48-7.8-2.77c-5.26-1.74-10.6-3.23-16-4.79-2.72-.79-5.47-1.58-8.29-2.61a31.74,31.74,0,0,1-4.33-1.92,14.39,14.39,0,0,1-2.29-1.53,8.74,8.74,0,0,1-2.22-2.66,7.2,7.2,0,0,1-.78-4,9.09,9.09,0,0,1,1-3.24,18.93,18.93,0,0,1,3-4.21,44.88,44.88,0,0,1,3.29-3.19c.56-.5,1.12-1,1.68-1.45l1.61-1.33a84,84,0,0,0,10.88-11.88,326.2,326.2,0,0,0,18.79-27.53c5.88-9.5,11.48-19.19,16.89-29S380.1,146.16,385,136.13c1.22-2.51,2.42-5,3.57-7.54s2.29-5.09,3.14-7.45l.36-1c.14-.38.26-.75.42-1.12.29-.75.64-1.48,1-2.21a25.51,25.51,0,0,1,2.65-4.21,19.15,19.15,0,0,1,3.76-3.69,13.74,13.74,0,0,1,5.24-2.42,12.11,12.11,0,0,1,6.12.25,14.59,14.59,0,0,1,5,2.79,20.59,20.59,0,0,1,3.47,3.79,30.33,30.33,0,0,1,2.5,4.1c.35.7.7,1.39,1,2.1l.46,1.05.4,1,1.64,3.84,3.39,7.67q6.88,15.32,14.36,30.37c5,10,10.18,19.94,15.69,29.65a274.94,274.94,0,0,0,17.9,28A73.36,73.36,0,0,0,487.74,233c.49.4,1,.8,1.48,1.15l1.7,1.19a35,35,0,0,1,3.66,3,17.84,17.84,0,0,1,3.32,4.08,10.83,10.83,0,0,1,1.14,2.94,8.54,8.54,0,0,1,0,3.54,10.27,10.27,0,0,1-3.22,5.39,20.71,20.71,0,0,1-4.15,2.91,49,49,0,0,1-8.4,3.46,154,154,0,0,1-16.77,4.09l-4.15.81a9.18,9.18,0,0,0-2.87,1.08,9.51,9.51,0,0,0-4,4.7,12.55,12.55,0,0,0-.67,6.58,19.5,19.5,0,0,0,2.46,6.74A37.19,37.19,0,0,0,468,295.75a75,75,0,0,0,14.14,7.86,129.67,129.67,0,0,0,15.58,5.49A141.4,141.4,0,0,1,513.88,315a75,75,0,0,1,15.19,8.65,37.29,37.29,0,0,1,6.55,6.24,21.05,21.05,0,0,1,4.31,8.49,14.43,14.43,0,0,1-1.24,9.88,18.08,18.08,0,0,1-6.66,6.94,26.74,26.74,0,0,1-8.56,3.33c-2.84.61-5.65,1.06-8.44,1.49-5.58.86-11.13,1.61-16.52,2.77a53.48,53.48,0,0,0-7.81,2.22c-2.43.94-4.81,2.22-6,3.93a4.34,4.34,0,0,0-.77,2.82,8.45,8.45,0,0,0,1,3.29,28,28,0,0,0,4.82,6.25,80.74,80.74,0,0,0,12.81,10.4c9.29,6,19.72,10.29,30.24,14.17,5.27,1.95,10.59,3.79,15.85,5.86,2.63,1,5.24,2.14,7.79,3.39a37.94,37.94,0,0,1,7.28,4.51,11.9,11.9,0,0,1,3.63,15.57,34.68,34.68,0,0,1-4.53,7.16,77.45,77.45,0,0,1-5.64,6.29,77.31,77.31,0,0,0,5.41-6.46,34.27,34.27,0,0,0,4.22-7.21,12.64,12.64,0,0,0,.88-8,12.44,12.44,0,0,0-4.71-6.43,37.71,37.71,0,0,0-7.15-4.16c-2.53-1.16-5.13-2.18-7.76-3.14-5.26-1.91-10.62-3.62-16-5.44-10.65-3.63-21.34-7.64-31.11-13.64a83.84,83.84,0,0,1-13.61-10.49,31.27,31.27,0,0,1-5.6-6.94,12,12,0,0,1-1.55-4.68,8.17,8.17,0,0,1,.19-2.7,8.56,8.56,0,0,1,1.09-2.5,12.1,12.1,0,0,1,3.6-3.44,24.27,24.27,0,0,1,4.08-2.08,57.3,57.3,0,0,1,8.36-2.56c5.59-1.31,11.19-2.17,16.71-3.12,2.76-.48,5.5-1,8.15-1.59a22.1,22.1,0,0,0,7-2.87,13.3,13.3,0,0,0,4.82-5.15,9.42,9.42,0,0,0,.69-6.53,16,16,0,0,0-3.42-6.33,33.25,33.25,0,0,0-5.73-5.27,69.74,69.74,0,0,0-14.19-7.8,135.81,135.81,0,0,0-15.61-5.42,135.53,135.53,0,0,1-16.3-5.51,81,81,0,0,1-15.41-8.31,43.39,43.39,0,0,1-12.6-13,25.53,25.53,0,0,1-3.34-9,19.13,19.13,0,0,1,1-10,16.17,16.17,0,0,1,6.69-8,15.88,15.88,0,0,1,5-1.93l4.13-.84a147.75,147.75,0,0,0,16-4,42.41,42.41,0,0,0,7.17-3,14,14,0,0,0,2.74-1.92,3.42,3.42,0,0,0,1.12-1.68,2.41,2.41,0,0,0-.43-1.61,11.07,11.07,0,0,0-2-2.4,28,28,0,0,0-2.92-2.31l-1.76-1.22c-.65-.46-1.26-.94-1.86-1.43a59,59,0,0,1-6.43-6.27c-2-2.19-3.79-4.44-5.54-6.74a267,267,0,0,1-18.55-28.74c-5.63-9.85-10.89-19.86-16-30s-9.91-20.31-14.57-30.61l-3.45-7.76L417,124.48l-.42-1-.39-.88c-.25-.59-.54-1.15-.82-1.71a22.74,22.74,0,0,0-1.89-3.09,13,13,0,0,0-2.2-2.42,7,7,0,0,0-2.31-1.33,4.49,4.49,0,0,0-2.22-.09,8.55,8.55,0,0,0-4.59,3.32,17.85,17.85,0,0,0-1.84,2.92c-.26.54-.51,1.07-.73,1.64-.12.27-.22.56-.32.85l-.35,1c-1.06,2.93-2.23,5.47-3.42,8.1s-2.42,5.16-3.67,7.7c-5,10.18-10.29,20.16-15.77,30.05s-11.17,19.66-17.16,29.28a310.2,310.2,0,0,1-19.39,28.11,90.46,90.46,0,0,1-12,12.85l-1.65,1.35c-.52.43-1,.85-1.53,1.29a38,38,0,0,0-2.79,2.65,12.42,12.42,0,0,0-1.94,2.57,2.33,2.33,0,0,0-.28.76c0,.11,0,0,0,.09a4.57,4.57,0,0,0,1.7,1.35,25.15,25.15,0,0,0,3.36,1.51c2.46.92,5.11,1.72,7.79,2.52,5.36,1.58,10.84,3.16,16.25,5q4.06,1.37,8.08,2.94c1.34.53,2.67,1.07,4,1.63.64.27,1.36.57,2.1.94a19.66,19.66,0,0,1,2.18,1.24,11.85,11.85,0,0,1,4,4.13,8.64,8.64,0,0,1,1,3.24,9.11,9.11,0,0,1-.27,3.23,14.48,14.48,0,0,1-2.42,4.85,29.32,29.32,0,0,1-3.14,3.56,87.46,87.46,0,0,1-14,10.47c-4.85,3-9.79,5.84-14.76,8.55-9.94,5.42-20,10.49-29.91,15.72-5,2.62-9.88,5.28-14.63,8.12-2.37,1.42-4.7,2.89-6.88,4.46a22.06,22.06,0,0,0-5.45,5.14,8,8,0,0,0-.76,1.39,5.36,5.36,0,0,0-.33,1.32,4.1,4.1,0,0,0,.69,2.53,15.62,15.62,0,0,0,5.49,4.62A80.14,80.14,0,0,0,298.56,353c5.31,1.66,10.73,3.06,16.18,4.58a64.81,64.81,0,0,1,8.26,2.74,27.74,27.74,0,0,1,7.69,4.74,13.65,13.65,0,0,1,3,3.81,9.27,9.27,0,0,1,1,5,11.14,11.14,0,0,1-1.54,4.7,19.09,19.09,0,0,1-2.8,3.67,40.6,40.6,0,0,1-6.81,5.54,83.78,83.78,0,0,1-7.41,4.35c-10.11,5.26-20.76,9.16-31.39,12.82a161.69,161.69,0,0,0-15.52,6.37A74.57,74.57,0,0,0,255,420a32.17,32.17,0,0,0-5.82,5.89,16.21,16.21,0,0,0-3.19,7.52,13.61,13.61,0,0,0,1.59,8A20.29,20.29,0,0,0,252.95,447.85Z"
                        fill="#cb9866" />
                    <path
                        d="M207.5,484.06c7.05-5.11,15.14-8.66,23.34-11.63a177.13,177.13,0,0,1,25.29-6.88,263.65,263.65,0,0,1,52.22-4.49h3.28l3.28.09,6.56.19,6.55.39c2.18.13,4.37.26,6.54.48,4.35.39,8.71.74,13,1.28l6.51.75,6.49.91c17.3,2.5,34.41,6,51.36,10.19l12.62,3.2c4.18,1,8.34,2.18,12.55,3.06,8.38,2,16.82,3.63,25.29,5.13a353.5,353.5,0,0,0,51.17,5.47c17.11.32,34.36-.66,51-4.7a118.55,118.55,0,0,0,24.21-8.47,84.82,84.82,0,0,0,11.11-6.49,47.55,47.55,0,0,0,9.69-8.53,48.1,48.1,0,0,1-9,9.45,85.1,85.1,0,0,1-10.81,7.45,116.56,116.56,0,0,1-24.23,10.24,165.66,165.66,0,0,1-25.79,5.35,232.1,232.1,0,0,1-26.27,1.71c-8.77,0-17.55-.24-26.26-1.09-2.18-.2-4.37-.35-6.54-.6l-6.52-.78c-4.36-.46-8.67-1.19-13-1.82-8.64-1.37-17.22-3.09-25.74-5-4.28-.87-8.5-2-12.75-3l-12.62-3.11q-25.06-6.37-50.58-10.47a426.37,426.37,0,0,0-51.3-5.3c-8.59-.42-17.19-.29-25.78,0a240.1,240.1,0,0,0-25.68,2.24,186.57,186.57,0,0,0-25.27,5.19c-4.15,1.16-8.26,2.49-12.28,4.05-2,.79-4,1.6-6,2.52A50.82,50.82,0,0,0,207.5,484.06Z"
                        fill="#cb9866" />
                    <path
                        d="M374.32,502.55a48.15,48.15,0,0,0,1.24,14.35c1.15,4.52,3.29,8.64,6.49,11.35a18.5,18.5,0,0,0,5.51,3.14,39.06,39.06,0,0,0,6.41,1.82,65.78,65.78,0,0,0,13.68,1.12,72.9,72.9,0,0,0,13.72-1.44,44.51,44.51,0,0,0,6.46-1.85,17.75,17.75,0,0,0,5.51-3.15,25.45,25.45,0,0,0,7.24-11.17,52,52,0,0,0,1.9-6.91c.48-2.37.83-4.8,1.18-7.25a55.16,55.16,0,0,1,.64,7.42,40.11,40.11,0,0,1-.52,7.56,31.23,31.23,0,0,1-2.19,7.5,24.37,24.37,0,0,1-4.46,6.79,25.16,25.16,0,0,1-6.61,5,39.72,39.72,0,0,1-7.4,3A58.55,58.55,0,0,1,407.75,542a55,55,0,0,1-15.47-1.9,36.65,36.65,0,0,1-7.46-3,25.3,25.3,0,0,1-6.6-5,19.63,19.63,0,0,1-2.5-3.34,21.72,21.72,0,0,1-1.79-3.67,27.66,27.66,0,0,1-1.65-7.7,38.16,38.16,0,0,1,2-14.87Z"
                        fill="#cb9866" />

                </g>
                <path class="treeBottomPath" stroke="none" fill="none" stroke-width="8"
                    d="M207.5,484.1c0,0,58.5-43.1,211.1-3.1s191-16.9,191-16.9" />
                <path class="treePath" fill="none" stroke="none" stroke-miterlimit="10"
                    d="M252.95,447.85s-30.81-21.57,33.89-44.68,46.22-37,33.89-41.6-59.32-11.56-42.37-28.5,114-52.38,81.66-66.25S301.48,256,324.59,237.55,390.84,135.87,395.46,122c4.41-13.24,16.95-18.49,24.65,0s44.68,100.14,67.79,115.55-10.78,21.57-26.19,24.65-20,33.89,33.89,49.3,47.76,40.06,27.73,44.68-63.17,4.62-27.73,32.35,98.6,21.57,61.63,60.09" />
                <path class="treeBottom" mask="url(#treeBottomMask)"
                    d="M207.5,484.06c7.05-5.11,15.14-8.66,23.34-11.63a177.13,177.13,0,0,1,25.29-6.88,263.65,263.65,0,0,1,52.22-4.49h3.28l3.28.09,6.56.19,6.55.39c2.18.13,4.37.26,6.54.48,4.35.39,8.71.74,13,1.28l6.51.75,6.49.91c17.3,2.5,34.41,6,51.36,10.19l12.62,3.2c4.18,1,8.34,2.18,12.55,3.06,8.38,2,16.82,3.63,25.29,5.13a353.5,353.5,0,0,0,51.17,5.47c17.11.32,34.36-.66,51-4.7a118.55,118.55,0,0,0,24.21-8.47,84.82,84.82,0,0,0,11.11-6.49,47.55,47.55,0,0,0,9.69-8.53,48.1,48.1,0,0,1-9,9.45,85.1,85.1,0,0,1-10.81,7.45,116.56,116.56,0,0,1-24.23,10.24,165.66,165.66,0,0,1-25.79,5.35,232.1,232.1,0,0,1-26.27,1.71c-8.77,0-17.55-.24-26.26-1.09-2.18-.2-4.37-.35-6.54-.6l-6.52-.78c-4.36-.46-8.67-1.19-13-1.82-8.64-1.37-17.22-3.09-25.74-5-4.28-.87-8.5-2-12.75-3l-12.62-3.11q-25.06-6.37-50.58-10.47a426.37,426.37,0,0,0-51.3-5.3c-8.59-.42-17.19-.29-25.78,0a240.1,240.1,0,0,0-25.68,2.24,186.57,186.57,0,0,0-25.27,5.19c-4.15,1.16-8.26,2.49-12.28,4.05-2,.79-4,1.6-6,2.52A50.82,50.82,0,0,0,207.5,484.06Z"
                    fill="#cb9866" />
                <path class="treePot" mask="url(#treePotMask)"
                    d="M374.32,502.55a48.15,48.15,0,0,0,1.24,14.35c1.15,4.52,3.29,8.64,6.49,11.35a18.5,18.5,0,0,0,5.51,3.14,39.06,39.06,0,0,0,6.41,1.82,65.78,65.78,0,0,0,13.68,1.12,72.9,72.9,0,0,0,13.72-1.44,44.51,44.51,0,0,0,6.46-1.85,17.75,17.75,0,0,0,5.51-3.15,25.45,25.45,0,0,0,7.24-11.17,52,52,0,0,0,1.9-6.91c.48-2.37.83-4.8,1.18-7.25a55.16,55.16,0,0,1,.64,7.42,40.11,40.11,0,0,1-.52,7.56,31.23,31.23,0,0,1-2.19,7.5,24.37,24.37,0,0,1-4.46,6.79,25.16,25.16,0,0,1-6.61,5,39.72,39.72,0,0,1-7.4,3A58.55,58.55,0,0,1,407.75,542a55,55,0,0,1-15.47-1.9,36.65,36.65,0,0,1-7.46-3,25.3,25.3,0,0,1-6.6-5,19.63,19.63,0,0,1-2.5-3.34,21.72,21.72,0,0,1-1.79-3.67,27.66,27.66,0,0,1-1.65-7.7,38.16,38.16,0,0,1,2-14.87Z"
                    fill="#cb9866" />
                <g class="treeStar">
                    <path class="treeStarOutline" opacity="0"
                        d="M421,53.27c5,.83,10.08,1.52,15.15,2.13l3.8.45,1.9.21c.33,0,.6.06,1,.12a2.41,2.41,0,0,1,1.27.66,2.52,2.52,0,0,1,.56,2.76,3.42,3.42,0,0,1-.78,1.07l-.66.69-2.65,2.77c-1.78,1.83-3.54,3.68-5.35,5.48l-2.7,2.71L429.81,75l-.69.67-.34.33,0,0h0a.14.14,0,0,0,0-.08s0-.07,0,0l0,.24.07.47.57,3.78c.4,2.52.71,5,1.06,7.57l.94,7.59.22,1.9c0,.06,0,.19,0,.34a2.21,2.21,0,0,1,0,.43,2.72,2.72,0,0,1-.21.84,2.85,2.85,0,0,1-2.65,1.75,2.57,2.57,0,0,1-.82-.14,3.12,3.12,0,0,1-.65-.3l-1.64-1-6.58-3.91-6.63-3.81-3.34-1.86-.42-.23-.21-.12-.14-.07a1,1,0,0,0-.59,0,1.15,1.15,0,0,0-.31.12l-.43.22-.85.44c-2.27,1.17-4.54,2.31-6.79,3.52s-4.51,2.38-6.74,3.61l-3.36,1.83-.84.46a3.07,3.07,0,0,1-1.28.44,2.68,2.68,0,0,1-2.84-3l.15-1,.29-1.89.57-3.78,1.18-7.56,1.24-7.52a.13.13,0,0,0,0,.08l0,0-.10-.09-.17-.17-1.37-1.34-2.73-2.68-10.93-10.7-.34-.33a4,4,0,0,1-.64-.84,3.63,3.63,0,0,1-.43-2.12,3.68,3.68,0,0,1,2.64-3.17l.52-.11.25,0,.47-.06.95-.12,1.9-.25,7.58-1,7.6-.9,1.9-.23.95-.11c.24,0,.11,0,.09,0l-.09.05-.07.08,0,0,.09-.16.46-.84.91-1.68c2.41-4.5,4.95-8.92,7.51-13.34l1-1.66.48-.83.24-.41.13-.23a3.49,3.49,0,0,1,.22-.33,2.66,2.66,0,0,1,2.83-.9,2.52,2.52,0,0,1,1.26.84,2.85,2.85,0,0,1,.37.62l.18.44q1.45,3.54,3,7.06c1,2.36,2,4.68,3.06,7,.51,1.17,1.06,2.32,1.59,3.48l.8,1.74a2.12,2.12,0,0,0,.45.75A1.42,1.42,0,0,0,421,53.27Zm-.06.39a1.82,1.82,0,0,1-1-.46,2.52,2.52,0,0,1-.56-.86l-.84-1.72c-.56-1.14-1.11-2.3-1.69-3.43-1.17-2.27-2.29-4.56-3.5-6.81s-2.39-4.51-3.6-6.76l-.23-.42a.8.8,0,0,0-.14-.18.58.58,0,0,0-.33-.15.56.56,0,0,0-.57.28L407,36.48c-2.09,4.66-4.2,9.31-6.45,13.88l-.83,1.72-.42.86-.13.27a3.57,3.57,0,0,1-2,1.67,4.26,4.26,0,0,1-.84.18l-.95.13-1.89.27L386,56.53l-7.58,1-3.49.44a.45.45,0,0,0,.34-.4.51.51,0,0,0-.07-.28s-.06-.08-.07-.08l.33.34,10.65,11,2.66,2.75,1.33,1.37.4.42a3.41,3.41,0,0,1,.53.84,3.36,3.36,0,0,1,.24,1.95c-.53,2.56-1,5-1.57,7.52L388,90.85l-.83,3.73-.42,1.87-.2.9a.5.5,0,0,0,0,.3.58.58,0,0,0,.52.37,6.28,6.28,0,0,0,1.38-.58l3.46-1.62q3.47-1.61,6.9-3.3c2.3-1.1,4.57-2.26,6.85-3.39l.86-.43.43-.21a2.55,2.55,0,0,1,.57-.22,2.21,2.21,0,0,1,1.29.08l.29.13.21.11.42.23,3.37,1.81,6.8,3.51,6.85,3.41,1.71.85c.19.09.15.07.22.08a.25.25,0,0,0,.12,0.a.42.42,0,0,0,.21-.1.33.33,0,0,0,.1-.19.2.2,0,0,0,0-.09.1.1,0,0,0,0,0l0-.13L428.74,96l-1.42-7.52c-.43-2.51-.9-5-1.29-7.54l-.6-3.78-.08-.47,0-.24a3.75,3.75,0,0,1,0-.45,3.37,3.37,0,0,1,.52-1.9,3.33,3.33,0,0,1,.30-.40,3.73,3.73,0,0,1,.30-.30l.35-.32.7-.65,2.81-2.59,2.86-2.54c1.9-1.71,3.84-3.36,5.77-5l2.91-2.49a12.91,12.91,0,0,0,1.15-1,.7.7,0,0,0-.06-.79.73.73,0,0,0-.37-.26c-.23-.06-.6-.13-.89-.2l-1.87-.4L436,56.39C431,55.39,426,54.45,420.95,53.66Z"
                        fill="#FFFCF9" />
                    <path
                        d="M408.12,83.45l-17.78,8.94,3.72-19.55-14-14.15,19.74-2.5,9.13-17.68,8.48,18L437,59.73l-14.5,13.63,3,19.67Z"
                        fill="#C89568" />
                </g>
                <circle class="sparkle" fill="url(#dotGrad)" cx="0" cy="0" r="50" />

            </g>
        </svg>

        <!-- side panel: ti√™u ƒë·ªÅ + √¥ng gi√† noel -->
        <div class="side" aria-hidden="false">
            <h1 class="text typewriter">Merry Christmas</h1>
            <p class="text subtext">Ch√∫c b·∫°n m·ªôt Gi√°ng Sinh ·∫•m √°p, ƒë·∫ßy ni·ªÅm vui v√† nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ b√™n ng∆∞·ªùi th√¢n y√™u.</p>
            <!-- dotlottie player (module) -->
            <!-- Santa animation removed as requested -->
        </div>

         <!-- External scripts are preserved but stored as non-executing template script elements.
              We use data-src and data-type to recreate them when opening. Order is important. -->

        <script data-src="https://unpkg.co/gsap@3/dist/gsap.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/MorphSVGPlugin3.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/DrawSVGPlugin3.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/MotionPathPlugin.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/Physics2DPlugin3.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/EasePack3.min.js" data-type="text/javascript" type="text/template"></script>
        <script data-src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" data-type="module" type="text/template"></script>

        <!-- The big inline script from your original page (store as template) -->
        <script type="text/template" data-type="inline">
            // Paste the original inline JS from your file here (the GSAP setup, createParticles(), drawStar(), mainTl, ...)
            // Example:
            MorphSVGPlugin.convertToPath('polygon');
            var xmlns = "http://www.w3.org/2000/svg",
                xlinkns = "http://www.w3.org/1999/xlink",
                select = function (s) {
                    return document.querySelector(s);
                },
                selectAll = function (s) {
                    return document.querySelectorAll(s);
                },
                pContainer = select('.pContainer'),
                mainSVG = select('.mainSVG'),
                star = select('#star'),
                sparkle = select('.sparkle'),
                tree = select('#tree'),
                showParticle = true,
                particleColorArray = ['#E8F6F8', '#ACE8F8', '#F6FBFE', '#A2CBDC', '#B74551', '#5DBA72', '#910B28', '#910B28', '#446D39'],
                particleTypeArray = ['#star', '#circ', '#cross', '#heart'],
                particlePool = [],
                particleCount = 0,
                numParticles = 201;

            gsap.set('svg', { visibility: 'visible' });
            gsap.set(sparkle, { transformOrigin: '50% 50%', y: -100 });

            let getSVGPoints = (path) => {
                let arr = [];
                var rawPath = MotionPathPlugin.getRawPath(path)[0];
                rawPath.forEach((el, value) => {
                    let obj = {};
                    obj.x = rawPath[value * 2];
                    obj.y = rawPath[(value * 2) + 1];
                    if (value % 2) {
                        arr.push(obj);
                    }
                });
                return arr;
            };
            let treePath = getSVGPoints('.treePath'),
                treeBottomPath = getSVGPoints('.treeBottomPath'),
                mainTl = gsap.timeline({ delay: 0, repeat: 0 }),
                starTl;

            function flicker(p) {
                gsap.killTweensOf(p, { opacity: true });
                gsap.fromTo(p, { opacity: 1 }, { duration: 0.07, opacity: Math.random(), repeat: -1 });
            }

            function createParticles() {
                var i = numParticles, p;
                while (--i > -1) {
                    p = select(particleTypeArray[i % particleTypeArray.length]).cloneNode(true);
                    mainSVG.appendChild(p);
                    p.setAttribute('fill', particleColorArray[i % particleColorArray.length]);
                    p.setAttribute('class', "particle");
                    particlePool.push(p);
                    gsap.set(p, { x: -100, y: -100, transformOrigin: '50% 50%' });
                }
            }

            var getScale = gsap.utils.random(0.5, 3, 0.001, true);

            function playParticle() {
                if (!showParticle) return;
                var p = particlePool[particleCount];
                gsap.set(p, { x: gsap.getProperty('.pContainer', 'x'), y: gsap.getProperty('.pContainer', 'y'), scale: getScale() });
                var tl = gsap.timeline();
                tl.to(p, {
                    duration: gsap.utils.random(0.61, 6),
                    physics2D: {
                        velocity: gsap.utils.random(-23, 23),
                        angle: gsap.utils.random(-180, 180),
                        gravity: gsap.utils.random(-6, 50)
                    },
                    scale: 0,
                    rotation: gsap.utils.random(-123, 360),
                    ease: 'power1',
                    onStart: flicker,
                    onStartParams: [p],
                    onRepeat: (p) => { gsap.set(p, { scale: getScale() }); },
                    onRepeatParams: [p]
                });
                particleCount++;
                particleCount = (particleCount >= numParticles) ? 0 : particleCount;
            }

            function drawStar() {
                starTl = gsap.timeline({ onUpdate: playParticle });
                starTl.to('.pContainer, .sparkle', {
                    duration: 6,
                    motionPath: { path: '.treePath', autoRotate: false },
                    ease: 'linear'
                }).to('.pContainer, .sparkle', {
                    duration: 1,
                    onStart: function () { showParticle = false; },
                    x: treeBottomPath[0].x,
                    y: treeBottomPath[0].y
                }).to('.pContainer, .sparkle', {
                    duration: 2,
                    onStart: function () { showParticle = true; },
                    motionPath: { path: '.treeBottomPath', autoRotate: false },
                    ease: 'linear'
                }, '-=0').from('.treeBottomMask', {
                    duration: 2,
                    drawSVG: '0% 0%',
                    stroke: '#FFF',
                    ease: 'linear'
                }, '-=2');
            }

            createParticles();
            drawStar();

            mainTl.from(['.treePathMask', '.treePotMask'], {
                duration: 6,
                drawSVG: '0% 0%',
                stroke: '#FFF',
                stagger: { each: 6 },
                duration: gsap.utils.wrap([6, 1, 2]),
                ease: 'linear'
            }).from('.treeStar', {
                duration: 3,
                scaleY: 0,
                scaleX: 0.15,
                transformOrigin: '50% 50%',
                ease: 'elastic(1,0.5)'
            }, '-=4').to('.sparkle', {
                duration: 3,
                opacity: 0,
                ease: "rough({strength: 2, points: 100, template: linear, taper: both, randomize: true, clamp: false})"
            }, '-=0').to('.treeStarOutline', {
                duration: 1,
                opacity: 1,
                ease: "rough({strength: 2, points: 16, template: linear, taper: none, randomize: true, clamp: false})"
            }, '+=1');

            mainTl.add(starTl, 0);
            gsap.globalTimeline.timeScale(1.5);
        </script>

        <!-- also include any SVG particle templates that the scripts clone (keep them inside the template) -->
        <defs style="display:none">
            <circle id="circ" class="particle" cx="0" cy="0" r="1" />
            <polygon id="star" class="particle"
                points="4.55,0 5.95,2.85 9.1,3.3 6.82,5.52 7.36,8.65 4.55,7.17 1.74,8.65 2.27,5.52 0,3.3 3.14,2.85 " />
            <polygon id="cross" class="particle"
                points="4,3.5 2.5,2 4,0.5 3.5,0 2,1.5 0.5,0 0,0.5 1.5,2 0,3.5 0.5,4 2,2.5 3.5,4 " />
            <path id="heart" class="particle" d="M2.9,0C2.53,0,2.2,0.18,2,0.47C1.8,0.18,1.47,0,1.1,0C0.49,0,0,0.49,0,1.1
                C0,2.6,1.56,4,2,4s2-1.4,2-2.9C4,0.49,3.51,0,2.9,0z" />
        </defs>
        <!-- end original content -->
    </template>

    <script>
        (function () {
            const openBtn = document.getElementById('openBtn');
            const card = document.querySelector('.card');
            const cardInner = document.getElementById('cardInner');
            const template = document.getElementById('cardContent');
            const audio = document.getElementById('audio');

            let opened = false;
            let contentLoaded = false;

            // Snowfall effect (canvas)
            const snowCanvas = document.getElementById('snowCanvas');
            let snowCtx = null;
            let snowFlakes = [];
            let snowAnimId = null;
            let snowDpr = window.devicePixelRatio || 1;

            // device / accessibility detection
            const isNarrow = window.matchMedia('(max-width:600px)').matches;
            const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

            function createFlake(width, height) {
                // adapt flake sizes / speed for narrow screens
                const mobileFactor = isNarrow || isTouch ? 0.6 : 1;
                // larger flakes more visible: many medium plus some large ones
                const largeChance = Math.random();
                const size = largeChance < 0.12 ? (6 * mobileFactor + Math.random() * 6 * mobileFactor) : (2 * mobileFactor + Math.random() * 4 * mobileFactor); // radius
                return {
                    x: Math.random() * width,
                    y: Math.random() * -height,
                    r: size,
                    // slower vertical speed for gentle fall on desktop, even slower on mobile
                    vy: (0.15 + Math.random() * 0.6) * (isNarrow ? 0.9 : 1),
                    // gentler horizontal drift
                    vx: (Math.random() - 0.5) * (isNarrow ? 0.25 : 0.3),
                    swing: Math.random() * Math.PI * 2,
                    // slower swing for smoother motion
                    swingSpeed: (0.001 + Math.random() * 0.003) * (isNarrow ? 0.8 : 1),
                    alpha: 0.65 + Math.random() * 0.35
                };
            }

            function resizeSnow() {
                if (!snowCanvas) return;
                const rect = card.getBoundingClientRect();
                snowDpr = window.devicePixelRatio || 1;
                snowCanvas.width = Math.max(1, Math.floor(rect.width * snowDpr));
                snowCanvas.height = Math.max(1, Math.floor(rect.height * snowDpr));
                snowCanvas.style.width = rect.width + 'px';
                snowCanvas.style.height = rect.height + 'px';
                snowCtx = snowCanvas.getContext('2d');
                snowCtx.setTransform(snowDpr, 0, 0, snowDpr, 0, 0);

                // adjust number of flakes based on size and device
                const areaFactor = Math.max(0.5, (rect.width * rect.height) / (800 * 600));
                // reduce density on narrow/touch screens or when user prefers reduced motion
                const base = prefersReducedMotion ? 0 : (isNarrow || isTouch ? 35 : 70);
                const target = Math.round(base * areaFactor);
                while (snowFlakes.length < target) snowFlakes.push(createFlake(rect.width, rect.height));
                while (snowFlakes.length > target) snowFlakes.pop();
            }

            let lastSnowT = performance.now();
            function animateSnow(now) {
                if (!snowCtx) return;
                const rect = card.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                const dt = Math.min(50, now - lastSnowT) / 16.6667; // normalize to ~60fps
                lastSnowT = now;

                snowCtx.clearRect(0, 0, width, height);
                snowFlakes.forEach(f => {
                    // slower per-frame advancement for a gentle fall
                    f.swing += f.swingSpeed * dt * (isNarrow ? 6 : 10);
                    f.x += f.vx * dt * (isNarrow ? 6 : 10) + Math.sin(f.swing) * (isNarrow ? 0.14 : 0.2);
                    f.y += f.vy * dt * (isNarrow ? 6 : 10);
                    if (f.y > height + 10) {
                        // respawn at top
                        f.x = Math.random() * width;
                        f.y = -10 - Math.random() * 60;
                        f.vy = (0.4 + Math.random() * 1.2) * (isNarrow ? 0.9 : 1);
                    }

                    // draw with subtle glow for larger, clearer flakes
                    snowCtx.save();
                    snowCtx.beginPath();
                    snowCtx.fillStyle = 'rgba(255,255,255,' + (f.alpha) + ')';
                    // reduce blur on narrow devices for performance
                    if (f.r > 5 && !isNarrow) {
                        snowCtx.shadowBlur = 8;
                        snowCtx.shadowColor = 'rgba(255,255,255,0.9)';
                    } else {
                        snowCtx.shadowBlur = 1;
                        snowCtx.shadowColor = 'rgba(255,255,255,0.6)';
                    }
                    snowCtx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                    snowCtx.fill();
                    snowCtx.restore();
                });

                snowAnimId = requestAnimationFrame(animateSnow);
            }

            function startSnow() {
                if (!snowCanvas) return;
                // do not start snow if user prefers reduced motion
                if (prefersReducedMotion) return;
                resizeSnow();
                lastSnowT = performance.now();
                if (!snowAnimId) snowAnimId = requestAnimationFrame(animateSnow);
            }

            function stopSnow() {
                if (snowAnimId) cancelAnimationFrame(snowAnimId);
                snowAnimId = null;
            }

            window.addEventListener('resize', () => {
                resizeSnow();
            });
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) stopSnow(); else startSnow();
            });

            // Helper: load a single external script and return a Promise
            // We fetch first so we can detect HTML redirects (e.g. GSAP trial landing page)
            // and avoid injecting non-JS into the document which would break the page.
            async function loadExternalScript(src, type = 'text/javascript') {
                try {
                    // try to fetch the resource as text first
                    const resp = await fetch(src, { cache: 'no-cache', mode: 'cors' });
                    if (!resp.ok) throw new Error('Network response was not ok');
                    const text = await resp.text();

                    // simple heuristics to detect HTML/error pages
                    const lowered = text.slice(0, 200).toLowerCase();
                    if (lowered.indexOf('<!doctype') !== -1 || lowered.indexOf('<html') !== -1 || lowered.indexOf('oops!') !== -1 || lowered.indexOf('requires-membership') !== -1) {
                        console.warn('Skipping script because fetched resource looks like HTML or a landing page:', src);
                        return null; // resolve gracefully, don't throw
                    }

                    // inject the fetched JS as an inline script (preserves order)
                    const s = document.createElement('script');
                    if (type === 'module') s.type = 'module';
                    s.async = false;
                    s.textContent = text;
                    document.body.appendChild(s);
                    return s;
                } catch (err) {
                    // fetch failed (CORS or network). Fall back to adding a script tag with src.
                    return new Promise((resolve) => {
                        const s = document.createElement('script');
                        s.src = src;
                        if (type === 'module') s.type = 'module';
                        s.async = false;
                        s.onload = () => resolve(s);
                        s.onerror = (e) => {
                            console.warn('Failed to load external script (fallback) ', src, e);
                            resolve(null);
                        };
                        document.body.appendChild(s);
                    });
                }
            }

            // Helper: execute inline script content
            function runInlineScript(code, asModule = false) {
                const s = document.createElement('script');
                if (asModule) s.type = 'module';
                s.textContent = code;
                document.body.appendChild(s);
                return s;
            }

            // Inject template content into cardInner and execute scripts in order
            async function injectContentOnce() {
                if (contentLoaded) return;
                const tpl = template.content.cloneNode(true);

                // Separate script templates and non-script nodes
                const scriptTemplates = [];
                const nonScriptNodes = [];
                const nodes = Array.from(tpl.childNodes);
                nodes.forEach(node => {

                    if (node.tagName && node.tagName.toLowerCase() === 'script' && node.type === 'text/template') {
                        scriptTemplates.push(node);
                    } else {
                        nonScriptNodes.push(node);
                    }
                               });

                // 1) Load all external scripts (in order)
                for (const sTpl of scriptTemplates) {
                    const dataSrc = sTpl.getAttribute('data-src');
                    const dataType = sTpl.getAttribute('data-type') || 'text/javascript';
                    if (dataType === 'text/javascript') {
                        // Regular script
                        await loadExternalScript(dataSrc, dataType);
                    } else if (dataType === 'module') {
                        // Module script
                        await loadExternalScript(dataSrc, dataType);
                    }
                }

                // 2) Execute all inline scripts (in order)
                for (const node of nodes) {
                    if (node.tagName && node.tagName.toLowerCase() === 'script' && node.type === 'text/template') {
                        // Execute inline script
                        const code = node.innerHTML;
                        runInlineScript(code, node.getAttribute('data-type') === 'module');
                    } else {
                        // Append non-script nodes directly
                        cardInner.appendChild(node);
                    }
                }

                contentLoaded = true;
            }

            // Open/close card function with staged classes for book-fold effect
            var openTl = null;

            function createOpenTimeline() {
                if (prefersReducedMotion) return null;
                if (!window.gsap) return null;
                // create a timeline that emulates a slow page-turn
                var tl = gsap.timeline({ paused: true });

                // ensure 3D rendering
                gsap.set(['.card-cover', '.pages', '.card-inner'], { transformStyle: 'preserve-3d', force3D: true });

                // big page flip: adapt duration/intensity for narrow screens
                const mainDur = isNarrow ? 1.2 : 1.8;
                const settleDur = isNarrow ? 0.45 : 0.8;
                const pageRotation = isNarrow ? -140 : -160;
                tl.to('.pages', { duration: mainDur, rotationY: pageRotation, transformOrigin: 'left center', ease: 'power2.inOut' }, 0)
                    .to('.card-cover', { duration: mainDur, rotationY: -180, transformOrigin: 'left center', ease: 'power2.inOut' }, 0)
                    .to('.card-inner', { duration: mainDur, rotationY: isNarrow ? 6 : 10, x: isNarrow ? '8%' : '12%', z: isNarrow ? 4 : 8, ease: 'power2.out' }, 0.03)
                    // settle back the pages to a readable lean
                    .to('.pages', { duration: settleDur, rotationY: -12, ease: 'elastic.out(1, 0.6)' }, '>-0.15');

                return tl;
            }

            // Open/close card function with GSAP timeline when available
            function toggleCard(open) {
                // create timeline on demand after content scripts are loaded
                if (!openTl && typeof window.gsap !== 'undefined') {
                    openTl = createOpenTimeline();
                }

                if (open) {
                    if (openTl) {
                        // play GSAP timeline
                        card.classList.add('opening');
                        openTl.play(0);
                        // ensure final state class for non-GSAP CSS rules
                        setTimeout(() => card.classList.add('open'), 2200);
                    } else {
                        // CSS fallback
                        card.classList.add('opening');
                        requestAnimationFrame(() => card.classList.add('open'));
                    }
                    audio.play().catch(e => {});
                } else {
                    if (openTl) {
                        // reverse timeline for smooth close
                        openTl.reverse();
                        // remove 'open' class immediately so CSS reverses too
                        card.classList.remove('open');
                        // remove opening marker after timeline reverse duration
                        setTimeout(() => card.classList.remove('opening'), 2500);
                    } else {
                        card.classList.remove('open');
                        setTimeout(() => card.classList.remove('opening'), 2500);
                    }
                    audio.pause();
                    audio.currentTime = 0;
                }
                opened = open;
            }

            // Initial setup: inject content and close card
            injectContentOnce().then(() => {
                toggleCard(false);
                // start snowfall after layout is ready
                startSnow();
            });

            // Open button click handler
            openBtn.addEventListener('click', () => {
                const isOpen = openBtn.getAttribute('aria-pressed') === 'true';
                toggleCard(!isOpen);
                openBtn.setAttribute('aria-pressed', !isOpen);
            });

            // Close card when clicking outside of it
            document.addEventListener('click', (e) => {
                if (opened && !card.contains(e.target) && e.target !== openBtn) {
                    toggleCard(false);
                    openBtn.setAttribute('aria-pressed', 'false');
                }
            });
        })();
    </script>
</body>
</html>
